 AS V1.42 Beta [Bld 216] - Source File floppy2_commented.asm - Page 1 - 01/08/2026 08:09:42 PM


       1/       0 :                     ; Ready to assemble with asl. binary matches original
       2/       0 :                     ;****************************************************
       3/       0 :                     ; Used Labels
       4/       0 :                     ;****************************************************
       5/       0 :                     
       6/       0 : =$0                  CURDRV  EQU     $0000
       7/       0 : =$1                  STRSCTH EQU     $0001
       8/       0 : =$2                  STRSCTL EQU     $0002
       9/       0 : =$3                  NUMSCTH EQU     $0003
      10/       0 : =$4                  NUMSCTL EQU     $0004
      11/       0 : =$5                  LSCTLN  EQU     $0005
      12/       0 : =$6                  CURADRH EQU     $0006
      13/       0 : =$8                  FDSTAT  EQU     $0008
      14/       0 : =$9                  M0009   EQU     $0009
      15/       0 : =$A                  SECTOR  EQU     $000A
      16/       0 : =$B                  SECTCNT EQU     $000B
      17/       0 : =$D                  STATSAV EQU     $000D
      18/       0 : =$E                  FUNCSAV EQU     $000E
      19/       0 : =$F                  NMIVECSAV EQU     $000F
      20/       0 : =$12                 M0012   EQU     $0012
      21/       0 : =$13                 TRACKSAV EQU    $0013
      22/       0 : =$14                 M0014   EQU     $0014
      23/       0 : =$15                 WRDCNT  EQU     $0015
      24/       0 : =$16                 STACKSAV EQU     $0016
      25/       0 : =$18                 M0018   EQU     $0018
      26/       0 : =$19                 M0019   EQU     $0019
      27/       0 : =$20                 LDADDR  EQU     $0020
      28/       0 :                     ; The PIA has A0 and A1 switched!
      29/       0 :                     ; 00 with CRA2 Set is Peripheral Register A 
      30/       0 :                     ; 00 with CRA2 cleared is Data Direction Register A 
      31/       0 :                     ; 01 with CRB2 Set is Peripheral Register B 
      32/       0 :                     ; 01 with CRB2 cleared is Data Direction Register B 
      33/       0 :                     ; 02 is Control Register A
      34/       0 :                     ; 03 is Control Register B
      35/       0 : =$EC00               PIAREGA EQU     $EC00
      36/       0 : =$EC01               PIAREGB EQU     $EC01
      37/       0 : =$EC02               PIACTRL EQU     $EC02
      38/       0 : =$EC04               SSDA_0  EQU     $EC04
      39/       0 : =$EC05               SSDA_1  EQU     $EC05
      40/       0 : =$EC26               MEC26   EQU     $EC26
      41/       0 : =$EC27               MEC27   EQU     $EC27
      42/       0 : =$F000               PWRUP   EQU     $F000
      43/       0 :                     
      44/       0 : =$F018               XOUTCH  EQU     $F018
      45/       0 : =$F564               REENT2  EQU     $F564
      46/       0 : =$FCFC               PROM_0  EQU     $FCFC
      47/       0 : =$FF8A               XSTAKs  EQU     $FF8A
      48/       0 : =$FFFC               NMIsVC  EQU     $FFFC
      49/       0 :                     
      50/       0 :                     ;****************************************************
      51/       0 :                     ; Program's Code Areas
      52/       0 :                     ;****************************************************
      53/       0 :                     
      54/       0 :                     
      55/    E800 :                                     ORG     $E800
      56/    E800 :                     
      57/    E800 : 8E FF 8A            OSLOAD          LDS     #XSTAKs                  ; E800: 8E FF 8A  ; Set Stackpointer     
      58/    E803 : 4F                                  CLRA                             ; E803: 4F        ; |    
      59/    E804 : 97 00                               STAA    CURDRV                   ; E804: 97 00     ; Set Drive to zero   
      60/    E806 : 8D 48                               BSR     FDINIT2                  ; E806: 8D 48     ; Init PIA and SSDA
 AS V1.42 Beta [Bld 216] - Source File floppy2_commented.asm - Page 2 - 01/08/2026 08:09:42 PM


      61/    E808 : 8D 6B                               BSR     RESTOR                   ; E808: 8D 6B     ; 
      62/    E80A : 8D 47                               BSR     CHKERR                   ; E80A: 8D 47     ; 
      63/    E80C : CE 00 17                            LDX     #$0017                   ; E80C: CE 00 17  ; Start at Sector $17 (Bootblock) (0xB80)
      64/    E80F : DF 01                               STX     STRSCTH                  ; E80F: DF 01     ; |
      65/    E811 : CE 00 02                            LDX     #$0002                   ; E811: CE 00 02  ; Get 2 sectors
      66/    E814 : DF 03                               STX     NUMSCTH                  ; E814: DF 03     ; |
      67/    E816 : CE 00 20                            LDX     #LDADDR                  ; E816: CE 00 20  ; Load @ 0x20
      68/    E819 : DF 06                               STX     CURADRH                  ; E819: DF 06     ; |
      69/    E81B : 8D 4C                               BSR     READSC                   ; E81B: 8D 4C     ; Read the Sector
      70/    E81D : 8D 34                               BSR     CHKERR                   ; E81D: 8D 34     ; Check for Erroro
      71/    E81F : 7E 00 20                            JMP     LDADDR                   ; E81F: 7E 00 20  ; Execute loaded code....
      72/    E822 :                     ;------------------------------------------------
      73/    E822 : CE 00 00            FDINIT          LDX     #$0000                   ; E822: CE 00 00  ; |
      74/    E825 : FF EC 02                            STX     PIACTRL                  ; E825: FF EC 02  ; clr both control Reg.
      75/    E828 : FF EC 00                            STX     PIAREGA                  ; E828: FF EC 00  ; Set A and B to Input
      76/    E82B : CE D0 DA                            LDX     #$D0DA                   ; E82B: CE D0 DA  ; 
      77/    E82E : FF EC 04                            STX     SSDA_0                   ; E82E: FF EC 04  ; 
      78/    E831 : CE 04 04                            LDX     #$0404                   ; E831: CE 04 04  ; |
      79/    E834 : FF EC 02                            STX     PIACTRL                  ; E834: FF EC 02  ; Set A and B to Output Reg.
      80/    E837 : CE 1B 02                            LDX     #$1B02                   ; E837: CE 1B 02  ; |
      81/    E83A : FF EC 00                            STX     PIAREGA                  ; E83A: FF EC 00  ; Set DS0, DS1, DIRQ, HLD, WG high
      82/    E83D : CE 00 00                            LDX     #$0000                   ; E83D: CE 00 00  ; |
      83/    E840 : FF EC 02                            STX     PIACTRL                  ; E840: FF EC 02  ; Set both to Data direction Reg.
      84/    E843 : CE 1F 6F                            LDX     #$1F6F                   ; E843: CE 1F 0F  ; |
      85/    E846 : FF EC 00                            STX     PIAREGA                  ; E846: FF EC 00  ; PA0-PA4, PB0-PB3, PB5..6 Output
      86/    E849 : CE 3C 3E                            LDX     #$3C3E                   ; E849: CE 3C 3E  ; |
      87/    E84C : FF EC 02                            STX     PIACTRL                  ; E84C: FF EC 02  ; Select both Output Reg., Set CA2 (STEP), Set CB2 (NMI Timer), IRQB (IRQ) Set by LH Transition of CB1 (IDX)
      88/    E84F : 39                  ZE84F           RTS                              ; E84F: 39        ; Both Output Regsters Selected
      89/    E850 :                     ;------------------------------------------------
      90/    E850 : BD EB A9            FDINIT2         JSR     FDINIT3                  ; E850: BD EB A6  ; 
      91/    E853 :                     ;------------------------------------------------
      92/    E853 : 24 FA               CHKERR          BCC     ZE84F                    ; E853: 24 FA     ; no carry - no error
      93/    E855 : 8D 03                               BSR     PRNTER                   ; E855: 8D 03     ; Print for ex.: 'E2 ' for Error 0x32
      94/    E857 : 7E F5 64                            JMP     REENT2                   ; E857: 7E F5 64  ; 
      95/    E85A :                     ;------------------------------------------------
      96/    E85A : 86 45               PRNTER          LDAA    #$45                     ; E85A: 86 45      ; Load 'E'
      97/    E85C : 8D 08                               BSR     ZE866                    ; E85C: 8D 08      ; 
      98/    E85E : 96 08                               LDAA    FDSTAT                   ; E85E: 96 08      ; 
      99/    E860 : 8D 04                               BSR     ZE866                    ; E860: 8D 04      ; 
     100/    E862 : 86 20                               LDAA    #$20                     ; E862: 86 20      ; 
     101/    E864 : 8D 00                               BSR     ZE866                    ; E864: 8D 00      ; 
     102/    E866 : 7E F0 18            ZE866           JMP     XOUTCH                   ; E866: 7E F0 18   ; Print Accu A to Console
     103/    E869 :                     ;------------------------------------------------
     104/    E869 :                     ;READSC          LDAB    #$80                     ; E869: C6 80      ; 
     105/    E869 :                     ;                STAB    LSCTLN                   ; E86B: D7 05      ; 
     106/    E869 :                     ;READPS          CLRB                             ; E86D: 5F         ; 
     107/    E869 :                     ;                CPX     #MC640                   ; E86E: 8C C6 40   ; These CPX are just a method to deactivate the code after the LDAB
     108/    E869 :                     ;                CPX     #MC6C2                   ; E871: 8C C6 C2   ; These CPX are just a method to deactivate the code after the LDAB
     109/    E869 :                     ;                CPX     #MC608                   ; E874: 8C C6 08   ; These CPX are just a method to deactivate the code after the LDAB
     110/    E869 :                     ;                CPX     #MC610                   ; E877: 8C C6 10   ; These CPX are just a method to deactivate the code after the LDAB
     111/    E869 :                     ;                CPX     #MC682                   ; E87A: 8C C6 82   ; These CPX are just a method to deactivate the code after the LDAB
     112/    E869 :                     ;                CPX     #MC681                   ; E87D: 8C C6 81   ; These CPX are just a method to deactivate the code after the LDAB
     113/    E869 :                     ;                CPX     #MC6C0                   ; E880: 8C C6 C0   ; These CPX are just a method to deactivate the code after the LDAB
     114/    E869 :                     ;                CPX     #MC680                   ; E883: 8C C6 80   ; These CPX are just a method to deactivate the code after the LDAB
     115/    E869 :                     ;                CPX     #MC604                   ; E886: 8C C6 04   ; These CPX are just a method to deactivate the code after the LDAB
     116/    E869 :                     ;
     117/    E869 : C6 80               READSC          LDAB    #$80                     ; E869: C6 80    ; Bit 7 set     ; causes the number of sectors contained in NUMSCT beginning with STRSCT from CURDRV to be read into memory starting at the address contained in CURADR
     118/    E86B : D7 05                               STAB    LSCTLN                   ; E86B: D7 05      ; 
     119/    E86D : 5F                  READPS          CLRB                             ; E86D: 5F       ; NO Bit set    ; similar to READSC with the exception that the last sector is only partially read according to the contents of LSCTLN
     120/    E86E : 8C                                  FCB     $8C
 AS V1.42 Beta [Bld 216] - Source File floppy2_commented.asm - Page 3 - 01/08/2026 08:09:42 PM


     121/    E86F : C6 40               RDCRC           LDAB    #$40                     ; E86F: C6 40    ; Bit 6 set     ; This entry point causes the number of sectors contained in NUMSCT beginning with STRSCT from CURDRV to be read to check their CRCs
     122/    E871 : 8C                                  FCB     $8C
     123/    E872 : C6 C2               RWTEST          LDAB    #$C2                     ; E872: C6 C2    ; Bit 7,6,1 set ; 
     124/    E874 : 8C                                  FCB     $8C
     125/    E875 : C6 08               RESTOR          LDAB    #$08                     ; E875: C6 08    ; Bit 3 set     ; causes the read/write head on CURDRV to be positioned to cylinder zero. The only parameter required is CURDRV.
     126/    E877 : 8C                                  FCB     $8C
     127/    E878 : C6 10               SEEK            LDAB    #$10                     ; E878: C6 10    ; Bit 4 set     ; causes the read/write head of CURDRV to be positioned to the cylinder containing STRSCT
     128/    E87A : 8C                                  FCB     $8C
     129/    E87B : C6 82               WRTEST          LDAB    #$82                     ; E87B: C6 82    ; Bit 7,1 set   ; 
     130/    E87D : 8C                                  FCB     $8C
     131/    E87E : C6 81               WRDDAM          LDAB    #$81                     ; E87E: C6 81    ; Bit 7,0 set   ; 
     132/    E880 : 8C                                  FCB     $8C
     133/    E881 : C6 C0               WRVERF          LDAB    #$C0                     ; E881: C6 C0    ; Bit 7,6 set   ; 
     134/    E883 : 8C                                  FCB     $8C
     135/    E884 : C6 80               WRITSC          LDAB    #$80                     ; E884: C6 80    ; Bit 7 set     ; 
     136/    E886 : 8C                                  FCB     $8C
     137/    E887 : C6 04               CLOCK           LDAB    #$04                     ; E887: C6 04    ; Bit 2 set     ; 
     138/    E889 :                     
     139/    E889 : 07                                  TPA                              ; E889: 07         ; Transfer Status Reg to A
     140/    E88A : 0F                                  SEI                              ; E88A: 0F        ; 
     141/    E88B : 97 0D                               STAA    STATSAV                  ; E88B: 97 0D     ; Save Status Reg.
     142/    E88D : D7 0E                               STAB    FUNCSAV                  ; E88D: D7 0E     ; Save Function
     143/    E88F : 86 30                               LDAA    #$30                     ; E88F: 86 30     ; 
     144/    E891 : 97 08                               STAA    FDSTAT                   ; E891: 97 08     ; Clear Errors ('0')
     145/    E893 : 9F 16                               STS     STACKSAV                 ; E893: 9F 16     ; Set Stackpointer
     146/    E895 : FE FF FC                            LDX     NMIsVC                   ; E895: FE FF FC  ; |
     147/    E898 : DF 0F                               STX     NMIVECSAV                ; E898: DF 0F     ; Save old NMIISR
     148/    E89A : CE E9 3C                            LDX     #NMIISR                  ; E89A: CE E9 39  ; |
     149/    E89D : FF FF FC                            STX     NMIsVC                   ; E89D: FF FF FC  ; New NMIISR
     150/    E8A0 : BD ED 00                            JSR     $ED00                                      ; Jump to new ROM
     151/    E8A3 : CE 00 12                            LDX     #$0012                   ; E8A0: CE 00 12  ;  
     152/    E8A6 : 86 01                               LDAA    #$01                     ; E8A3: 86 01     ; 
     153/    E8A8 : 91 00                               CMPA    CURDRV                   ; E8A5: 91 00     ; is 0 at start
     154/    E8AA : 25 12                               BCS     ZE8BB                    ; E8A7: 25 12     ; if CURDRV > 1 Error
     155/    E8AC : 27 02                               BEQ     ZE8AD                    ; E8A9: 27 02     ; if CURRDRV == 1 leave it @ $12
     156/    E8AE : 09                                  DEX                              ; E8AB: 09        ; else, down to $11
     157/    E8AF : 4C                                  INCA                             ; E8AC: 4C        ; A is 2 now
     158/    E8B0 : B7 EC 00            ZE8AD           STAA    PIAREGA                  ; E8AD: B7 EC 00  ; Write DS0, TG43, DIRQ, HLD low, Set DS1
     159/    E8B3 : A6 00                               LDAA    ,X                       ; E8B0: A6 00     ; X @ $11 for Drive 0 or $12 for Drive 1
     160/    E8B5 : 97 13                               STAA    TRACKSAV                 ; E8B2: 97 13     ; 
     161/    E8B7 : 86 40                               LDAA    #$40                     ; E8B4: 86 40     ; PA6 (RDY)
     162/    E8B9 : B5 EC 00                            BITA    PIAREGA                  ; E8B6: B5 EC 00  ; Check Drive Ready
     163/    E8BC : 27 07                               BEQ     DRVRDY                   ; E8B9: 27 07     ; 
     164/    E8BE : C6 33               ZE8BB           LDAB    #$33                     ; E8BB: C6 33     ; Error '3' (DISK NOT READY)
     165/    E8C0 :                     ;                CPX     #MC636                   ; E8BD: 8C C6 36  ; 
     166/    E8C0 : 8C                                  FCB     $8C
     167/    E8C1 : C6 36               ZE8BE           LDAB    #$36                                       ; Set Error '6' (INVALID DISK ADDRESS)
     168/    E8C3 : 20 7E                               BRA     SETERR                   ; E8C0: 20 7E     ; 
     169/    E8C5 :                     ;------------------------------------------------
     170/    E8C5 : C5 08               DRVRDY          BITB    #$08                     ; E8C2: C5 08     ; Get Bit3 from FUNCSAV (RESTOR)
     171/    E8C7 : 27 05                               BEQ     ZE8CB                    ; E8C4: 27 05     ; 
     172/    E8C9 : 5F                                  CLRB                             ; E8C6: 5F        ; 
     173/    E8CA : 86 03                               LDAA    #$03                     ; E8C7: 86 03     ; <------------------------------------ What is this??????
     174/    E8CC : 20 3F                               BRA     RESTORY                  ; E8C9: 20 3F          
     175/    E8CE :                     ;------------------------------------------------
     176/    E8CE : C5 04               ZE8CB           BITB    #$04                     ; E8CB: C5 04     ; Get Bit2 from FUNCSAV (CLOCK)
     177/    E8D0 : 27 03                               BEQ     RESTORN                  ; E8CD: 27 03     ;
     178/    E8D2 : 7E EB 88                            JMP     CLKDMD                   ; E8CF: 7E EB 85  ;
     179/    E8D5 :                     ;------------------------------------------------
     180/    E8D5 : D6 02               RESTORN         LDAB    STRSCTL                  ; E8D2: D6 02     ; RESTOR is NOT active
 AS V1.42 Beta [Bld 216] - Source File floppy2_commented.asm - Page 4 - 01/08/2026 08:09:42 PM


     181/    E8D7 : 96 01                               LDAA    STRSCTH                  ; E8D4: 96 01     ; Get Startsector
     182/    E8D9 : DB 04                               ADDB    NUMSCTL                  ; E8D6: DB 04     ; |
     183/    E8DB : 99 03                               ADCA    NUMSCTH                  ; E8D8: 99 03     ; Add Number of sectors
     184/    E8DD : 25 E2                               BCS     ZE8BE                    ; E8DA: 25 E2     ; Set Error '6': INVALID DISK ADDRESS
     185/    E8DF : C1 D3                               CMPB    #$D3                     ; E8DC: C1 D3     ; |
     186/    E8E1 : 82 07                               SBCA    #$07                     ; E8DE: 82 07     ; 0x7D3 = 2003 (sector too big)
     187/    E8E3 : 24 DC                               BCC     ZE8BE                    ; E8E0: 24 DC     ; Set Error '6': INVALID DISK ADDRESS
     188/    E8E5 : 86 FF                               LDAA    #$FF                     ; E8E2: 86 FF     ; 
     189/    E8E7 : 97 0A                               STAA    SECTOR                   ; E8E4: 97 0A     ; 
     190/    E8E9 : 96 01                               LDAA    STRSCTH                  ; E8E6: 96 01     ; Startsector is usually at $17 at boot
     191/    E8EB : D6 02                               LDAB    STRSCTL                  ; E8E8: D6 02     ; |
     192/    E8ED : 7C 00 0A            ZE8EA           INC     SECTOR                   ; E8EA: 7C 00 0A  ; is now at 0
     193/    E8F0 : C0 D0                               SUBB    #$D0                     ; E8ED: C0 D0     ; 0xd0 = 208 (8 tracks exactly)
     194/    E8F2 : 82 00                               SBCA    #$00                     ; E8EF: 82 00     ; 
     195/    E8F4 : 24 F7                               BCC     ZE8EA                    ; E8F1: 24 F7     ; 
     196/    E8F6 : CB D0                               ADDB    #$D0                     ; E8F3: CB D0     ; 
     197/    E8F8 : 96 0A                               LDAA    SECTOR                   ; E8F5: 96 0A     ; is 0
     198/    E8FA : 48                                  ASLA                             ; E8F7: 48        ; 
     199/    E8FB : 48                                  ASLA                             ; E8F8: 48        ; 
     200/    E8FC : 48                                  ASLA                             ; E8F9: 48        ; 
     201/    E8FD : 4A                                  DECA                             ; E8FA: 4A        ; 
     202/    E8FE : 4C                  ZE8FB           INCA                             ; E8FB: 4C        ; 
     203/    E8FF : C0 1A                               SUBB    #$1A                     ; E8FC: C0 1A     ; $1a = 26
     204/    E901 : 24 FB                               BCC     ZE8FB                    ; E8FE: 24 FB     ; 
     205/    E903 : CB 1A                               ADDB    #$1A                     ; E900: CB 1A     ; $1a = 26
     206/    E905 : D7 0A                               STAB    SECTOR                   ; E902: D7 0A     ; 
     207/    E907 : DE 03                               LDX     NUMSCTH                  ; E904: DE 03     ; 
     208/    E909 : DF 0B                               STX     SECTCNT                  ; E906: DF 0B     ; 
     209/    E90B : D6 13                               LDAB    TRACKSAV                 ; E908: D6 13     ; 
     210/    E90D : 97 13               RESTORY         STAA    TRACKSAV                 ; E90A: 97 13     ; contains track (0 if RESTOR or 3)
     211/    E90F : 10                                  SBA                              ; E90C: 10        ; B cont. 0 if RESTOR
     212/    E910 : F6 EC 00                            LDAB    PIAREGA                  ; E90D: F6 EC 00  ;                                        <******************** different
     213/    E913 : CA 08                               ORAB    #$08                     ; E910: CA 08     ; Isolate Bit 3 (DIRQ)
     214/    E915 : 24 03                               BCC     ZE917                    ; E912: 24 03     ; 
     215/    E917 : C4 F7                               ANDB    #$F7                     ; E914: C4 F7     ; Isolate Bit 3 (DIRQ)
     216/    E919 : 40                                  NEGA                             ; E916: 40        ; 
     217/    E91A : C4 EF               ZE917           ANDB    #$EF                     ; E917: C4 EF     ; Isolate PA4 (HLD)
     218/    E91C : 81 04                               CMPA    #$04                     ; E919: 81 04     ; Compare A with 4   <------------ WHY
     219/    E91E : 23 02                               BLS     ZE91F                    ; E91B: 23 02     ; 
     220/    E920 : CA 10                               ORAB    #$10                     ; E91D: CA 10     ; Set Bit 4 (HLD)
     221/    E922 : F7 EC 00            ZE91F           STAB    PIAREGA                  ; E91F: F7 EC 00  ; Write to Port
     222/    E925 : 4A                                  DECA                             ; E922: 4A        ; 
     223/    E926 : 2B 45                               BMI     ZE96A                    ; E923: 2B 45     ; 
     224/    E928 : 8D 1F                               BSR     STEP                     ; E925: 8D 1F     ; 
     225/    E92A : F6 EC 00                            LDAB    PIAREGA                  ; E927: F6 EC 00  ; 
     226/    E92D : 2A EB                               BPL     ZE917                    ; E92A: 2A EB     ; Bit 7 clear? (TRK0)
     227/    E92F : 4D                                  TSTA                             ; E92C: 4D        ; 
     228/    E930 : 27 3B                               BEQ     ZE96A                    ; E92D: 27 3B     ; 
     229/    E932 : 96 0E                               LDAA    FUNCSAV                  ; E92F: 96 0E     ; 
     230/    E934 : 85 08                               BITA    #$08                     ; E931: 85 08     ; 
     231/    E936 : 27 09                               BEQ     ZE93E                    ; E933: 27 09     ; Function = RESTOR, Set Error
     232/    E938 : 8D 25                               BSR     WAIT2                    ; E935: 8D 25     ; Wait
     233/    E93A : 20 58                               BRA     ERRHNDLR                 ; E937: 20 58     ; 
     234/    E93C :                     ;------------------------------------------------
     235/    E93C : 9E 16               NMIISR          LDS     STACKSAV                 ; E939: 9E 16     ; 
     236/    E93E : C6 35                               LDAB    #$35                     ; E93B: C6 35     ; Set Error '5' (TIMEOUT)
     237/    E940 :                     ;                CPX     #MC637                   ; E93D: 8C C6 37  ; 
     238/    E940 : 8C                                  FCB     $8C
     239/    E941 : C6 37               ZE93E           LDAB    #$37                                       ; Set Error '7' (SEEK ERROR)
     240/    E943 : D7 08               SETERR          STAB    FDSTAT                   ; E940: D7 08     ; 
 AS V1.42 Beta [Bld 216] - Source File floppy2_commented.asm - Page 5 - 01/08/2026 08:09:42 PM


     241/    E945 : 8D 4D                               BSR     ERRHNDLR                 ; E942: 8D 4D     ; 
     242/    E947 : 0D                                  SEC                              ; E944: 0D        ; 
     243/    E948 : 39                                  RTS                              ; E945: 39        ; 
     244/    E949 :                     ;------------------------------------------------
     245/    E949 : C6 34               STEP            LDAB    #$34                     ; E946: C6 34     ; Bit 5,4,2 set
     246/    E94B : F7 EC 02                            STAB    PIACTRL                  ; E948: F7 EC 02  ; CA2 low (STEP)
     247/    E94E : C6 3C                               LDAB    #$3C                     ; E94B: C6 3C     ; Bit 5,4,3,2 set
     248/    E950 : F7 EC 02                            STAB    PIACTRL                  ; E94D: F7 EC 02  ; CA2 high (STEP)
     249/    E953 : CE 00 FE                            LDX     #$00FE                   ; E950: CE 00 FE  ;                                        <******************** different
     250/    E956 : D6 19               WAIT3           LDAB    M0019                    ; E953: D6 19     ; 
     251/    E958 : 5A                  WAIT1           DECB                             ; E955: 5A        ; 
     252/    E959 : 26 FD                               BNE     WAIT1                    ; E956: 26 FD     ; 
     253/    E95B : 09                                  DEX                              ; E958: 09        ; 
     254/    E95C : 26 F8                               BNE     WAIT3                    ; E959: 26 F8     ; 
     255/    E95E : 39                                  RTS                              ; E95B: 39        ; 
     256/    E95F :                     ;------------------------------------------------
     257/    E95F : CE 01 87            WAIT2           LDX     #$0187                   ; E95C: CE 01 87  ; 
     258/    E962 : 20 F2                               BRA     WAIT3                    ; E95F: 20 F2     ; 
     259/    E964 :                     ;------------------------------------------------
     260/    E964 : 96 13               ZE961           LDAA    TRACKSAV                 ; E961: 96 13     ; 
     261/    E966 : 27 D9                               BEQ     ZE93E                    ; E963: 27 D9     ; 
     262/    E968 : 4F                                  CLRA                             ; E965: 4F        ; 
     263/    E969 : C6 56                               LDAB    #$56                     ; E966: C6 56     ; <------------------------------------ What is this??????
     264/    E96B : 20 A0                               BRA     RESTORY                  ; E968: 20 A0     ; 
     265/    E96D :                     ;------------------------------------------------
     266/    E96D : CE 02 C0            ZE96A           LDX     #$02C0                   ; E96A: CE 02 C0  ; |
     267/    E970 : 8D E4                               BSR     WAIT3                    ; E96D: 8D E4     ; Wait
     268/    E972 : 96 0E                               LDAA    FUNCSAV                  ; E96F: 96 0E     ; 
     269/    E974 : 85 08                               BITA    #$08                     ; E971: 85 08     ; Is Function = RESTOR ?
     270/    E976 : 26 EC                               BNE     ZE961                    ; E973: 26 EC     ; If yes Set Error '7' (SEEK ERROR)
     271/    E978 : 85 10                               BITA    #$10                     ; E975: 85 10     ; Is FUNCTION SEEK?
     272/    E97A : 26 18                               BNE     ERRHNDLR                 ; E977: 26 18     ; 
     273/    E97C : C6 6F                               LDAB    #$6F                     ; E979: C6 6F     ; 
     274/    E97E : 46                                  RORA                             ; E97B: 46        ; 
     275/    E97F : 24 02                               BCC     ZE980                    ; E97C: 24 02     ; 
     276/    E981 : C6 6A                               LDAB    #$6A                     ; E97E: C6 6A     ; 
     277/    E983 : D7 14               ZE980           STAB    M0014                    ; E980: D7 14     ; 
     278/    E985 : 20 4F                               BRA     ZE9D3                    ; E982: 20 4F     ; next sector
     279/    E987 :                     ;------------------------------------------------
     280/    E987 : 96 0E               ZE984           LDAA    FUNCSAV                  ; E984: 96 0E     ; 
     281/    E989 : 2A 09                               BPL     ERRHNDLR                 ; E986: 2A 09     ; 
     282/    E98B : 84 40                               ANDA    #$40                     ; E988: 84 40     ; 
     283/    E98D : 97 0E                               STAA    FUNCSAV                  ; E98A: 97 0E     ; 
     284/    E98F : 27 03                               BEQ     ERRHNDLR                 ; E98C: 27 03     ; 
     285/    E991 : 7E E8 D5                            JMP     RESTORN                  ; E98E: 7E E8 D2  ; 
     286/    E994 :                     ;------------------------------------------------
     287/    E994 : CE 03 3C            ERRHNDLR        LDX     #$033C                   ; E991: CE 03 3C  ; 
     288/    E997 : FF EC 01                            STX     PIAREGB                  ; E994: FF EC 01  ; Set PB0,1 (RESET and WG) and Select A Output Reg., Set CA2 (STEP)
     289/    E99A : DE 0F                               LDX     NMIVECSAV                ; E997: DE 0F     ; |
     290/    E99C : FF FF FC                            STX     NMIsVC                   ; E999: FF FF FC  ; Restore old NMIISR
     291/    E99F : 96 13                               LDAA    TRACKSAV                 ; E99C: 96 13     ; 
     292/    E9A1 : D6 00                               LDAB    CURDRV                   ; E99E: D6 00     ; 
     293/    E9A3 : 27 03                               BEQ     ZE9A5                    ; E9A0: 27 03     ; 
     294/    E9A5 : 97 12                               STAA    M0012                    ; E9A2: 97 12     ; 
     295/    E9A7 :                     ;                CPX     #$9711                   ; E9A4: 8C 97 11  ; 
     296/    E9A7 : 8C                                  FCB     $8C
     297/    E9A8 : 97 11               ZE9A5           STAA    $11                                       ;
     298/    E9AA : 96 0D                               LDAA    STATSAV                  ; E9A7: 96 0D     ; 
     299/    E9AC : 06                                  TAP                              ; E9A9: 06        ; Transfer A to Status Register
     300/    E9AD : 0C                                  CLC                              ; E9AA: 0C        ; 
 AS V1.42 Beta [Bld 216] - Source File floppy2_commented.asm - Page 6 - 01/08/2026 08:09:42 PM


     301/    E9AE : 39                                  RTS                              ; E9AB: 39        ; 
     302/    E9AF :                     ;------------------------------------------------
     303/    E9AF : CE D0 D8            READINIT        LDX     #$D0D8                   ; E9AC: CE D0 D8  ; Select CR2 and Inhibit SM, 2-Byte RDA, 8-Bit Word
     304/    E9B2 : FF EC 04                            STX     SSDA_0                   ; E9AF: FF EC 04  ; |
     305/    E9B5 : CE EC 00                            LDX     #PIAREGA                 ; E9B2: CE EC 00  ; 
     306/    E9B8 : 86 50                               LDAA    #$50                     ; E9B5: 86 50     ; 
     307/    E9BA : A7 04                               STAA    $04,X                    ; E9B7: A7 04     ; Write $50 to SSDA_0
     308/    E9BC : 86 07                               LDAA    #$07                     ; E9B9: 86 07     ; 
     309/    E9BE : A7 01                               STAA    $01,X                    ; E9BB: A7 01     ; Write 7 to PIAREGB (Set to Read, Reset active., WG inact.)
     310/    E9C0 : 6A 01                               DEC     $01,X                    ; E9BD: 6A 01     ; Reset inact.
     311/    E9C2 : 08                                  INX                              ; E9BF: 08        ; 
     312/    E9C3 : 09                                  DEX                              ; E9C0: 09        ; 
     313/    E9C4 : 86 40                               LDAA    #$40                     ; E9C1: 86 40     ; Write $40 to SSDA_0 (Enable Sync, Select CR2)
     314/    E9C6 : A7 04                               STAA    $04,X                    ; E9C3: A7 04     ; 
     315/    E9C8 : 86 98                               LDAA    #$98                     ; E9C5: 86 98     ; Write $98 to SSDA_1 (Enable SM Output)
     316/    E9CA : A7 05                               STAA    $05,X                    ; E9C7: A7 05     ; 
     317/    E9CC : 39                                  RTS                              ; E9C9: 39        ; 
     318/    E9CD :                     ;------------------------------------------------
     319/    E9CD : 97 0A               ZE9CA           STAA    SECTOR                   ; E9CA: 97 0A     ;                                        <******************** different
     320/    E9CF : BD E9 49                            JSR     STEP                     ; E9CC: BD E9 46  ; 
     321/    E9D2 : 8D 8B                               BSR     WAIT2                    ; E9CF: 8D 8B     ; 
     322/    E9D4 : 6C 13                               INC     $13,X                    ; E9D1: 6C 13     ; 
     323/    E9D6 : 7C 00 0A            ZE9D3           INC     SECTOR                   ; E9D3: 7C 00 0A  ; 
     324/    E9D9 : 96 0A                               LDAA    SECTOR                   ; E9D6: 96 0A     ; 
     325/    E9DB : DE 0B                               LDX     SECTCNT                  ; E9D8: DE 0B     ; 
     326/    E9DD : 27 A8                               BEQ     ZE984                    ; E9DA: 27 A8     ; 
     327/    E9DF : 80 1B                               SUBA    #$1B                     ; E9DC: 80 1B     ; Sector == 27?
     328/    E9E1 : 24 EA                               BCC     ZE9CA                    ; E9DE: 24 EA     ; increase Track
     329/    E9E3 : 86 05                               LDAA    #$05                     ; E9E0: 86 05     ; 
     330/    E9E5 : 97 18                               STAA    M0018                    ; E9E2: 97 18     ; 
     331/    E9E7 : 09                                  DEX                              ; E9E4: 09        ; 
     332/    E9E8 : 86 40               ZE9E5           LDAA    #$40                     ; E9E5: 86 40     ; One Sector is $40 words
     333/    E9EA : DF 0B                               STX     SECTCNT                  ; E9E7: DF 0B     ; 
     334/    E9EC : 26 07                               BNE     ZE9F2                    ; E9E9: 26 07     ; 
     335/    E9EE : 96 05                               LDAA    LSCTLN                   ; E9EB: 96 05     ; LAST SECTOR LENGTH (1-128)
     336/    E9F0 : 8B 07                               ADDA    #$07                     ; E9ED: 8B 07     ; 
     337/    E9F2 : 44                                  LSRA                             ; E9EF: 44        ; convert to words
     338/    E9F3 : 84 FC                               ANDA    #$FC                     ; E9F0: 84 FC     ; 
     339/    E9F5 : 97 15               ZE9F2           STAA    WRDCNT                   ; E9F2: 97 15     ; is $40 for every full sector
     340/    E9F7 : 40                                  NEGA                             ; E9F4: 40        ; 
     341/    E9F8 : D6 0E                               LDAB    FUNCSAV                  ; E9F5: D6 0E     ; 
     342/    E9FA : 58                                  ASLB                             ; E9F7: 58        ; 
     343/    E9FB : 2A 01                               BPL     ZE9FB                    ; E9F8: 2A 01     ; if reading jump
     344/    E9FD : 4F                                  CLRA                             ; E9FA: 4F        ; 
     345/    E9FE : 8B 40               ZE9FB           ADDA    #$40                     ; E9FB: 8B 40     ; 
     346/    EA00 : 97 09                               STAA    M0009                    ; E9FD: 97 09     ; 
     347/    EA02 : BD EB 77                            JSR     RETRG                    ; E9FF: BD EB 74  ; Retrigger NMI Timer
     348/    EA05 : 96 13                               LDAA    TRACKSAV                 ; EA02: 96 13     ; 
     349/    EA07 : CA 0C                               ORAB    #$0C                     ; EA04: CA 0C     ; In B is PIA Port A, isol. Bit 2,3 (TG43, DIRQ)
     350/    EA09 : 81 2B                               CMPA    #$2B                     ; EA06: 81 2B     ; check for Track > 43
     351/    EA0B : 23 02                               BLS     ZEA0C                    ; EA08: 23 02     ; No
     352/    EA0D : C4 FB                               ANDB    #$FB                     ; EA0A: C4 FB     ; Clr Bit 2 (TG43)
     353/    EA0F : E7 00               ZEA0C           STAB    ,X                       ; EA0C: E7 00     ; Set Port
     354/    EA11 : CE D2 70                            LDX     #$D270                   ; EA0E: CE D2 70  ; Inhibit: Sync,Tx,Rx,Select CR3 and 1 Sync Character,Internal Sync,Clear: TUF,CTS
     355/    EA14 : FF EC 04                            STX     SSDA_0                   ; EA11: FF EC 04  ; |
     356/    EA17 : CE D1 F5                            LDX     #$D1F5                   ; EA14: CE D1 F5  ; Select Sync Code Register and Set Sync Code to hex F5
     357/    EA1A : FF EC 04                            STX     SSDA_0                   ; EA17: FF EC 04  ; |
     358/    EA1D :                     ;*************************************************
     359/    EA1D :                     ; Looking for ID Addr. Mark, correct Track and Sector
     360/    EA1D :                     ;*************************************************
 AS V1.42 Beta [Bld 216] - Source File floppy2_commented.asm - Page 7 - 01/08/2026 08:09:42 PM


     361/    EA1D : 8D 90               ZEA1A           BSR     READINIT                 ; EA1A: 8D 90     ; X is on PIAREGA (EC00), Toggle RESET
     362/    EA1F : A6 04               ZEA1C           LDAA    $04,X                    ; EA1C: A6 04     ; Read SSDA Status Reg.
     363/    EA21 : 2A FC                               BPL     ZEA1C                    ; EA1E: 2A FC     ; Wait for Data
     364/    EA23 : A6 05                               LDAA    $05,X                    ; EA20: A6 05     ; Read SSDA Data Reg
     365/    EA25 : 81 7E                               CMPA    #$7E                     ; EA22: 81 7E     ; ID address mark ?
     366/    EA27 : 26 F4                               BNE     ZEA1A                    ; EA24: 26 F4     ; No ?, Try again.
     367/    EA29 : A6 04               ZEA26           LDAA    $04,X                    ; EA26: A6 04     ; *********** Found Id Addr. Mark ***********
     368/    EA2B : 2A FC                               BPL     ZEA26                    ; EA28: 2A FC     ; Wait for Data
     369/    EA2D : A6 05                               LDAA    $05,X                    ; EA2A: A6 05     ; Read SSDA Data Reg into A
     370/    EA2F : E6 05                               LDAB    $05,X                    ; EA2C: E6 05     ; Read SSDA Data Reg into B
     371/    EA31 : 91 13                               CMPA    TRACKSAV                 ; EA2E: 91 13     ; Compare with Track
     372/    EA33 : 26 E8                               BNE     ZEA1A                    ; EA30: 26 E8     ; Try again
     373/    EA35 : A6 04               ZEA32           LDAA    $04,X                    ; EA32: A6 04     ; We are on the right Track, Read SSDA Status Reg.
     374/    EA37 : 2A FC                               BPL     ZEA32                    ; EA34: 2A FC     ; Wait for Data
     375/    EA39 : A6 05                               LDAA    $05,X                    ; EA36: A6 05     ; Read SSDA Data Reg into A
     376/    EA3B : E6 05                               LDAB    $05,X                    ; EA38: E6 05     ; Read SSDA Data Reg into B
     377/    EA3D : 91 0A                               CMPA    SECTOR                   ; EA3A: 91 0A     ; Compare with sector
     378/    EA3F : 26 DC                               BNE     ZEA1A                    ; EA3C: 26 DC     ; Try again
     379/    EA41 : A6 04               ZEA3E           LDAA    $04,X                    ; EA3E: A6 04     ; Found Sector, Read SSDA Status Reg.
     380/    EA43 : 2A FC                               BPL     ZEA3E                    ; EA40: 2A FC     ; Wait for Data
     381/    EA45 : 6D 05                               TST     $05,X                    ; EA42: 6D 05     ; 
     382/    EA47 : 96 19                               LDAA    M0019                    ; EA44: 96 19     ; 
     383/    EA49 : 80 03               ZEA46           SUBA    #$03                     ; EA46: 80 03     ; 
     384/    EA4B : 22 FC                               BHI     ZEA46                    ; EA48: 22 FC     ; 
     385/    EA4D : A6 01                               LDAA    $01,X                    ; EA4A: A6 01     ; Read PIAREGB
     386/    EA4F : 2B 3B                               BMI     ZEA89                    ; EA4C: 2B 3B     ; PB7 High ? (CRC-0) - ERROR
     387/    EA51 :                     ;*************************************************
     388/    EA51 :                     ; Found corr. Track and Sector, now look for Data Addr. Mark
     389/    EA51 :                     ;*************************************************
     390/    EA51 : A6 05                               LDAA    $05,X                    ; EA4E: A6 05     ;                                        <******************** different
     391/    EA53 : 86 04                               LDAA    #$04                     ; EA50: 86 04     ; Try four times
     392/    EA55 : 6D 04               ZEA52           TST     $04,X                    ; EA52: 6D 04     ; Read SSDA Status Reg.
     393/    EA57 : 2A FC                               BPL     ZEA52                    ; EA54: 2A FC     ; Wait for Data
     394/    EA59 : A1 05                               CMPA    $05,X                    ; EA56: A1 05     ; Compare SSDA Data Reg to A (04)
     395/    EA5B : A1 05                               CMPA    $05,X                    ; EA58: A1 05     ; Compare SSDA Data Reg to A (04)
     396/    EA5D : 4A                                  DECA                             ; EA5A: 4A        ; |
     397/    EA5E : 26 F5                               BNE     ZEA52                    ; EA5B: 26 F5     ; try again
     398/    EA60 : D6 0E                               LDAB    FUNCSAV                  ; EA5D: D6 0E     ; 
     399/    EA62 : 2B 7C                               BMI     WRITINIT                 ; EA5F: 2B 7C     ; Bit 7 set - Write Function
     400/    EA64 : D6 19                               LDAB    M0019                    ; EA61: D6 19     ; Waitloop
     401/    EA66 : 58                                  ASLB                             ; EA63: 58        ; |
     402/    EA67 : 08                  ZEA64           INX                              ; EA64: 08        ; |
     403/    EA68 : 09                                  DEX                              ; EA65: 09        ; |
     404/    EA69 : 5A                                  DECB                             ; EA66: 5A        ; |
     405/    EA6A : 26 FB                               BNE     ZEA64                    ; EA67: 26 FB     ; |
     406/    EA6C : C6 04                               LDAB    #$04                     ; EA69: C6 04     ; Try four times
     407/    EA6E : BD E9 AF            ZEA6B           JSR     READINIT                 ; EA6B: BD E9 AC  ; Initialize SSDA for Read, Toggle RESET
     408/    EA71 : DE 06                               LDX     CURADRH                  ; EA6E: DE 06     ; 
     409/    EA73 : B6 EC 04            ZEA70           LDAA    SSDA_0                   ; EA70: B6 EC 04  ; Read SSDA Status Reg.
     410/    EA76 : 2A FB                               BPL     ZEA70                    ; EA73: 2A FB     ; Wait and Test RDA for 2 Bytes Ready
     411/    EA78 : B6 EC 05                            LDAA    SSDA_1                   ; EA75: B6 EC 05  ; Read Data
     412/    EA7B : 81 6F                               CMPA    #$6F                     ; EA78: 81 6F     ; Sync data address mark
     413/    EA7D : 27 21                               BEQ     READSECT                 ; EA7A: 27 21     ; ********** Found data address mark *************
     414/    EA7F : 81 6A                               CMPA    #$6A                     ; EA7C: 81 6A     ; Read DELETED DATA MARK (set Error '4')
     415/    EA81 : 27 18                               BEQ     ZEA98                    ; EA7E: 27 18     ; |
     416/    EA83 : 5A                                  DECB                             ; EA80: 5A        ; |
     417/    EA84 : 26 E8                               BNE     ZEA6B                    ; EA81: 26 E8     ; again
     418/    EA86 : C6 38                               LDAB    #$38                     ; EA83: C6 38     ; 
     419/    EA88 :                     ;                CPX     #MC631                   ; EA85: 8C C6 31  ; 
     420/    EA88 : 8C                                  FCB     $8C
 AS V1.42 Beta [Bld 216] - Source File floppy2_commented.asm - Page 8 - 01/08/2026 08:09:42 PM


     421/    EA89 : C6 31               ZEA86           LDAB    #$31                                       ; (Set Error '1') (DATA CRC ERROR)
     422/    EA8B :                     ;                CPX     #MC639                   ; EA88: 8C C6 39  ; 
     423/    EA8B : 8C                                  FCB     $8C
     424/    EA8C : C6 39               ZEA89           LDAB    #$39                                        ; (Set Error '9') (ADDRESS MARK CRC ERROR)
     425/    EA8E : 7A 00 18                            DEC     M0018                    ; EA8B: 7A 00 18  ; 
     426/    EA91 : 27 0A                               BEQ     ZEA9A                    ; EA8E: 27 0A     ; 
     427/    EA93 : DE 0B                               LDX     SECTCNT                  ; EA90: DE 0B     ; 
     428/    EA95 : 7E E9 E8                            JMP     ZE9E5                    ; EA92: 7E E9 E5  ; 
     429/    EA98 :                     ;------------------------------------------------
     430/    EA98 : C6 32               DSKWPROT        LDAB    #$32                     ; EA95: C6 32     ; Set Error '2' (DISK WRITE PROTECTED)
     431/    EA9A :                     ;                CPX     #MC634                   ; EA97: 8C C6 34  ; 
     432/    EA9A : 8C                                  FCB     $8C
     433/    EA9B : C6 34               ZEA98           LDAB    #$34                                        ; (Set Error '4') (READ DELETED DATA MARK)
     434/    EA9D : 7E E9 43            ZEA9A           JMP     SETERR                   ; EA9A: 7E E9 40  ; 
     435/    EAA0 :                     ;------------------------------------------------
     436/    EAA0 : D6 0E               READSECT        LDAB    FUNCSAV                  ; EA9D: D6 0E     ; data address mark found
     437/    EAA2 : 58                                  ASLB                             ; EA9F: 58        ; 
     438/    EAA3 : 2B 19                               BMI     ZEABB                    ; EAA0: 2B 19     ; Check for READCRC ($40)
     439/    EAA5 : D6 15                               LDAB    WRDCNT                   ; EAA2: D6 15     ; Wordcount?
     440/    EAA7 : B6 EC 04            ZEAA4           LDAA    SSDA_0                   ; EAA4: B6 EC 04  ; Read SSDA Status Reg.
     441/    EAAA : 2A FB                               BPL     ZEAA4                    ; EAA7: 2A FB     ; Wait and Test RDA for 2 Bytes Ready
     442/    EAAC : B6 EC 05                            LDAA    SSDA_1                   ; EAA9: B6 EC 05  ; Read Data to Buffer
     443/    EAAF : BC FC FC                            CPX     PROM_0                   ; EAAC: BC FC FC  ; X is on $20, in PROM_0 is zero *** This does nothing ! ***
     444/    EAB2 : A7 00                               STAA    ,X                       ; EAAF: A7 00     ; |
     445/    EAB4 : B6 EC 05                            LDAA    SSDA_1                   ; EAB1: B6 EC 05  ; |
     446/    EAB7 : A7 01                               STAA    $01,X                    ; EAB4: A7 01     ; |
     447/    EAB9 : 08                                  INX                              ; EAB6: 08        ; |
     448/    EABA : 08                                  INX                              ; EAB7: 08        ; |
     449/    EABB : 5A                                  DECB                             ; EAB8: 5A        ; |
     450/    EABC : 26 E9                               BNE     ZEAA4                    ; EAB9: 26 E9     ; 
     451/    EABE : D6 09               ZEABB           LDAB    M0009                    ; EABB: D6 09     ; counter
     452/    EAC0 : B6 EC 04            READCRC         LDAA    SSDA_0                   ; EABD: B6 EC 04  ; Read SSDA Status Reg.
     453/    EAC3 : 2A FB                               BPL     READCRC                  ; EAC0: 2A FB     ; Wait and Test RDA for 2 Bytes Ready
     454/    EAC5 : 5A                                  DECB                             ; EAC2: 5A        ; dec. counter
     455/    EAC6 : 2B 08                               BMI     ZEACD                    ; EAC3: 2B 08     ; finished ?
     456/    EAC8 : B6 EC 05                            LDAA    SSDA_1                   ; EAC5: B6 EC 05  ; Read SSDA Data to A
     457/    EACB : B6 EC 05                            LDAA    SSDA_1                   ; EAC8: B6 EC 05  ; Read SSDA Data to A
     458/    EACE : 20 F0                               BRA     READCRC                  ; EACB: 20 F0     ; continue
     459/    EAD0 :                     ;------------------------------------------------
     460/    EAD0 : 96 19               ZEACD           LDAA    M0019                    ; EACD: 96 19     ; 
     461/    EAD2 : 80 03               ZEACF           SUBA    #$03                     ; EACF: 80 03     ; 
     462/    EAD4 : 22 FC                               BHI     ZEACF                    ; EAD1: 22 FC     ; 
     463/    EAD6 : B6 EC 01                            LDAA    PIAREGB                  ; EAD3: B6 EC 01  ; |
     464/    EAD9 : 2B AE                               BMI     ZEA86                    ; EAD6: 2B AE     ; PB7 High ? (CRC-0) Error
     465/    EADB : DF 06                               STX     CURADRH                  ; EAD8: DF 06     ; CRC ok
     466/    EADD : 7E E9 D6                            JMP     ZE9D3                    ; EADA: 7E E9 D3  ; next sector
     467/    EAE0 :                     ;------------------------------------------------
     468/    EAE0 : CE C0 DA            WRITINIT        LDX     #$C0DA                   ; EADD: CE C0 DA  ; 
     469/    EAE3 : FF EC 04                            STX     SSDA_0                   ; EAE0: FF EC 04  ; 
     470/    EAE6 : CE C1 AA                            LDX     #$C1AA                   ; EAE3: CE C1 AA  ; 
     471/    EAE9 : FF EC 04                            STX     SSDA_0                   ; EAE6: FF EC 04  ; 
     472/    EAEC : CE C2 70                            LDX     #$C270                   ; EAE9: CE C2 70  ; 
     473/    EAEF : FF EC 04                            STX     SSDA_0                   ; EAEC: FF EC 04  ; 
     474/    EAF2 : 7C EC 01                            INC     PIAREGB                  ; EAEF: 7C EC 01  ; 
     475/    EAF5 : 86 82                               LDAA    #$82                     ; EAF2: 86 82     ; Bit 1,7
     476/    EAF7 : B7 EC 04                            STAA    SSDA_0                   ; EAF4: B7 EC 04  ; WG off, PB7 is an Input 
     477/    EAFA : 09                                  DEX                              ; EAF7: 09        ; 
     478/    EAFB : B7 EC 01                            STAA    PIAREGB                  ; EAF8: B7 EC 01  ; 
     479/    EAFE : 86 10                               LDAA    #$10                     ; EAFB: 86 10     ; Bit 4
     480/    EB00 : B5 EC 01                            BITA    PIAREGB                  ; EAFD: B5 EC 01  ; Check Writeprot?
 AS V1.42 Beta [Bld 216] - Source File floppy2_commented.asm - Page 9 - 01/08/2026 08:09:42 PM


     481/    EB03 : 27 93                               BEQ     DSKWPROT                 ; EB00: 27 93     ; If yes set Error
     482/    EB05 : 96 19                               LDAA    M0019                    ; EB02: 96 19     ; Waitloop
     483/    EB07 : 80 03                               SUBA    #$03                     ; EB04: 80 03     ; |
     484/    EB09 : 48                                  ASLA                             ; EB06: 48        ; |
     485/    EB0A : 4A                  ZEB07           DECA                             ; EB07: 4A        ; |
     486/    EB0B : 2A FD                               BPL     ZEB07                    ; EB08: 2A FD     ; |
     487/    EB0D : 7F EC 01                            CLR     PIAREGB                  ; EB0A: 7F EC 01  ; Clear all PB (Set to Write, Reset off, ShiftCRC off, WG on)
     488/    EB10 : 56                                  RORB                             ; EB0D: 56        ; 
     489/    EB11 : 24 01                               BCC     ZEB11                    ; EB0E: 24 01     ; 
     490/    EB13 :                     ;                BITA    #$56                     ; EB10: 85 56     ; 
     491/    EB13 : 85                                  FCB     $85                
     492/    EB14 : 56                  ZEB11           RORB                             ;                 
     493/    EB15 : CE 00 05                            LDX     #$0005                   ; EB12: CE 00 05  ; 
     494/    EB18 : BD E9 56                            JSR     WAIT3                    ; EB15: BD E9 53  ; 
     495/    EB1B : C6 40                               LDAB    #$40                     ; EB18: C6 40     ; 
     496/    EB1D : 96 14                               LDAA    M0014                    ; EB1A: 96 14     ; 
     497/    EB1F : CE 83 F5                            LDX     #$83F5                   ; EB1C: CE 83 F5  ; 
     498/    EB22 : FF EC 04                            STX     SSDA_0                   ; EB1F: FF EC 04  ; 
     499/    EB25 : DE 06                               LDX     CURADRH                  ; EB22: DE 06     ; 
     500/    EB27 : B7 EC 05                            STAA    SSDA_1                   ; EB24: B7 EC 05  ; 
     501/    EB2A : 7E EB 34                            JMP     ZEB31                    ; EB27: 7E EB 31  ; 
     502/    EB2D :                     ;------------------------------------------------
     503/    EB2D : 86 40               ZEB2A           LDAA    #$40                     ; EB2A: 86 40     ; 
     504/    EB2F : B5 EC 04            ZEB2C           BITA    SSDA_0                   ; EB2C: B5 EC 04  ; 
     505/    EB32 : 27 FB                               BEQ     ZEB2C                    ; EB2F: 27 FB     ; 
     506/    EB34 : B6 FC FC            ZEB31           LDAA    PROM_0                   ; EB31: B6 FC FC  ; in PROM_0 is zero
     507/    EB37 : 01                                  NOP                              ; EB34: 01        ; 
     508/    EB38 : A6 00                               LDAA    ,X                       ; EB35: A6 00     ; 
     509/    EB3A : B7 EC 05                            STAA    SSDA_1                   ; EB37: B7 EC 05  ; 
     510/    EB3D : A6 01                               LDAA    $01,X                    ; EB3A: A6 01     ; 
     511/    EB3F : B7 EC 05                            STAA    SSDA_1                   ; EB3C: B7 EC 05  ; 
     512/    EB42 : 25 02                               BCS     ZEB43                    ; EB3F: 25 02     ; 
     513/    EB44 : 08                                  INX                              ; EB41: 08        ; 
     514/    EB45 : 08                                  INX                              ; EB42: 08        ; 
     515/    EB46 : 5A                  ZEB43           DECB                             ; EB43: 5A        ; 
     516/    EB47 : 26 E4                               BNE     ZEB2A                    ; EB44: 26 E4     ; 
     517/    EB49 : DF 06                               STX     CURADRH                  ; EB46: DF 06     ; 
     518/    EB4B : CE EC 00                            LDX     #PIAREGA                 ; EB48: CE EC 00  ; 
     519/    EB4E : 86 40                               LDAA    #$40                     ; EB4B: 86 40     ; 
     520/    EB50 : A5 04               ZEB4D           BITA    $04,X                    ; EB4D: A5 04     ; 
     521/    EB52 : 27 FC                               BEQ     ZEB4D                    ; EB4F: 27 FC     ; 
     522/    EB54 : E7 05                               STAB    $05,X                    ; EB51: E7 05     ; 
     523/    EB56 : A5 04               ZEB53           BITA    $04,X                    ; EB53: A5 04     ; 
     524/    EB58 : 27 FC                               BEQ     ZEB53                    ; EB55: 27 FC     ; 
     525/    EB5A : C6 08                               LDAB    #$08                     ; EB57: C6 08     ; 
     526/    EB5C : E7 01                               STAB    $01,X                    ; EB59: E7 01     ; 
     527/    EB5E : E7 05                               STAB    $05,X                    ; EB5B: E7 05     ; 
     528/    EB60 : A5 04               ZEB5D           BITA    $04,X                    ; EB5D: A5 04     ; 
     529/    EB62 : 27 FC                               BEQ     ZEB5D                    ; EB5F: 27 FC     ; 
     530/    EB64 : C6 FF                               LDAB    #$FF                     ; EB61: C6 FF     ; 
     531/    EB66 : E7 05                               STAB    $05,X                    ; EB63: E7 05     ; 
     532/    EB68 : E7 05                               STAB    $05,X                    ; EB65: E7 05     ; 
     533/    EB6A : A5 04               ZEB67           BITA    $04,X                    ; EB67: A5 04     ; 
     534/    EB6C : 27 FC                               BEQ     ZEB67                    ; EB69: 27 FC     ; 
     535/    EB6E : 6F 01                               CLR     $01,X                    ; EB6B: 6F 01     ; 
     536/    EB70 : 6C 01                               INC     $01,X                    ; EB6D: 6C 01     ; 
     537/    EB72 : 6C 01                               INC     $01,X                    ; EB6F: 6C 01     ; 
     538/    EB74 : 7E E9 D6                            JMP     ZE9D3                    ; EB71: 7E E9 D3  ; next sector
     539/    EB77 :                     ;------------------------------------------------
     540/    EB77 : CE EC 00            RETRG           LDX     #PIAREGA                 ; EB74: CE EC 00  ; 
 AS V1.42 Beta [Bld 216] - Source File floppy2_commented.asm - Page 10 - 01/08/2026 08:09:42 PM


     541/    EB7A : 86 36                               LDAA    #$36                     ; EB77: 86 36     ; |
     542/    EB7C : A7 03                               STAA    $03,X                    ; EB79: A7 03     ; $36 -> PIACTRLB (CB2 Low - Trigger NMI Timer, IRQB Flag set by HL on CB1 - IDX, Select Output Reg. B)
     543/    EB7E : 86 3E                               LDAA    #$3E                     ; EB7B: 86 3E     ; |
     544/    EB80 : A7 03                               STAA    $03,X                    ; EB7D: A7 03     ; $3E -> PIACTRLB (CB2 high)
     545/    EB82 : E6 00                               LDAB    ,X                       ; EB7F: E6 00     ; Get Port A
     546/    EB84 : 4A                                  DECA                             ; EB81: 4A        ; 
     547/    EB85 : A7 02                               STAA    $02,X                    ; EB82: A7 02     ; $3D -> PIACTRLA (En. IRQA interrupt by CA1 - NMI Timer, Sel. Output Reg. A, CA2 high - STEP)
     548/    EB87 : 39                                  RTS                              ; EB84: 39        ; 
     549/    EB88 :                     ;------------------------------------------------
     550/    EB88 : 8D ED               CLKDMD          BSR     RETRG                    ; EB85: 8D ED     ; Retrigger NMI Timer
     551/    EB8A : E6 01                               LDAB    $01,X                    ; EB87: E6 01     ; PIAREGB
     552/    EB8C : 4F                                  CLRA                             ; EB89: 4F        ; 
     553/    EB8D : E6 03               ZEB8A           LDAB    $03,X                    ; EB8A: E6 03     ; PIACTRLB
     554/    EB8F : 2A FC                               BPL     ZEB8A                    ; EB8C: 2A FC     ; 
     555/    EB91 : E6 01                               LDAB    $01,X                    ; EB8E: E6 01     ; 
     556/    EB93 : 5F                  CLRTOP          CLRB                             ; EB90: 5F        ; 
     557/    EB94 : 5A                  ZEB91           DECB                             ; EB91: 5A        ; 
     558/    EB95 : 26 FD                               BNE     ZEB91                    ; EB92: 26 FD     ; 
     559/    EB97 : 4C                                  INCA                             ; EB94: 4C        ; 
     560/    EB98 : 6D 03                               TST     $03,X                    ; EB95: 6D 03     ; 
     561/    EB9A : 2A F7                               BPL     CLRTOP                   ; EB97: 2A F7     ; 
     562/    EB9C : 5C                                  INCB                             ; EB99: 5C        ; 
     563/    EB9D : 80 4B                               SUBA    #$4B                     ; EB9A: 80 4B     ; 
     564/    EB9F : 5C                  ZEB9C           INCB                             ; EB9C: 5C        ; 
     565/    EBA0 : 80 16                               SUBA    #$16                     ; EB9D: 80 16     ; 
     566/    EBA2 : 24 FB                               BCC     ZEB9C                    ; EB9F: 24 FB     ; 
     567/    EBA4 : D7 19                               STAB    M0019                    ; EBA1: D7 19     ; 
     568/    EBA6 : 7E E9 94                            JMP     ERRHNDLR                 ; EBA3: 7E E9 91  ; 
     569/    EBA9 :                     ;------------------------------------------------
     570/    EBA9 : BD E8 22            FDINIT3         JSR     FDINIT                   ; EBA6: BD E8 22  ; 
     571/    EBAC : 7E E8 87                            JMP     CLOCK                    ; EBA9: 7E E8 87  ; 
     572/    EBAF :                     ;------------------------------------------------
     573/    EBAF : 36                  ZEBAC           PSHA                             ; EBAC: 36        ; 
     574/    EBB0 : F6 EC 26            ZEBAD           LDAB    MEC26                    ; EBAD: F6 EC 26  ; <------------------------------------ no RAM here!
     575/    EBB3 : C5 01                               BITB    #$01                     ; EBB0: C5 01     ; 
     576/    EBB5 : 27 26                               BEQ     ZEBDA                    ; EBB2: 27 26     ; 
     577/    EBB7 : B6 EC 27                            LDAA    MEC27                    ; EBB4: B6 EC 27  ; <------------------------------------ no RAM here!
     578/    EBBA : 81 13                               CMPA    #$13                     ; EBB7: 81 13     ; 
     579/    EBBC : 26 1F                               BNE     ZEBDA                    ; EBB9: 26 1F     ; 
     580/    EBBE : F6 EC 26            ZEBBB           LDAB    MEC26                    ; EBBB: F6 EC 26  ; <------------------------------------ no RAM here!
     581/    EBC1 : 20 0F                               BRA     ZEBCF                    ; EBBE: 20 0F     ; 
     582/    EBC3 :                     ;------------------------------------------------
     583/    EBC3 : 86 03               LPINIT          LDAA    #$03                     ; EBC0: 86 03     ; 
     584/    EBC5 : B7 EC 26                            STAA    MEC26                    ; EBC2: B7 EC 26  ; <------------------------------------ no RAM here!
     585/    EBC8 : 86 15                               LDAA    #$15                     ; EBC5: 86 15     ; 
     586/    EBCA : B7 EC 26                            STAA    MEC26                    ; EBC7: B7 EC 26  ; <------------------------------------ no RAM here! 
     587/    EBCD : 39                                  RTS                              ; EBCA: 39        ; 
     588/    EBCE :                     ;------------------------------------------------
     589/    EBCE : 01                                  NOP                              ; EBCB: 01        ; 
     590/    EBCF : 37                  LIST            PSHB                             ; EBCC: 37        ; 
     591/    EBD0 : 20 DD                               BRA     ZEBAC                    ; EBCD: 20 DD     ; 
     592/    EBD2 :                     ;------------------------------------------------
     593/    EBD2 : C5 01               ZEBCF           BITB    #$01                     ; EBCF: C5 01     ; 
     594/    EBD4 : 27 E8                               BEQ     ZEBBB                    ; EBD1: 27 E8     ; 
     595/    EBD6 : B6 EC 27                            LDAA    MEC27                    ; EBD3: B6 EC 27  ; <------------------------------------ no RAM here!
     596/    EBD9 : 81 11                               CMPA    #$11                     ; EBD6: 81 11     ; 
     597/    EBDB : 26 E1                               BNE     ZEBBB                    ; EBD8: 26 E1     ; 
     598/    EBDD : C5 02               ZEBDA           BITB    #$02                     ; EBDA: C5 02     ; 
     599/    EBDF : 27 CF                               BEQ     ZEBAD                    ; EBDC: 27 CF     ; 
     600/    EBE1 : 32                                  PULA                             ; EBDE: 32        ; 
 AS V1.42 Beta [Bld 216] - Source File floppy2_commented.asm - Page 11 - 01/08/2026 08:09:42 PM


     601/    EBE2 : B7 EC 27                            STAA    MEC27                    ; EBDF: B7 EC 27  ; <------------------------------------ no RAM here!
     602/    EBE5 : 33                                  PULB                             ; EBE2: 33        ; 
     603/    EBE6 : 39                                  RTS                              ; EBE3: 39        ; 
     604/    EBE7 :                     ;------------------------------------------------
     605/    EBE7 : 86 0D               LDATA0          LDAA    #$0D                     ; EBE4: 86 0D     ; Send String to Printer
     606/    EBE9 : 8D E4                               BSR     LIST                     ; EBE6: 8D E4     ; 
     607/    EBEB : 09                                  DEX                              ; EBE8: 09        ; 
     608/    EBEC : 86 0A                               LDAA    #$0A                     ; EBE9: 86 0A     ; 
     609/    EBEE : 20 02                               BRA     ZEBEF                    ; EBEB: 20 02     ; 
     610/    EBF0 :                     ;------------------------------------------------
     611/    EBF0 : 01                                  NOP                              ; EBED: 01        ; 
     612/    EBF1 : 01                                  NOP                              ; EBEE: 01        ; 
     613/    EBF2 : 8D DB               ZEBEF           BSR     LIST                     ; EBEF: 8D DB     ; 
     614/    EBF4 : 08                                  INX                              ; EBF1: 08        ; 
     615/    EBF5 : A6 00                               LDAA    ,X                       ; EBF2: A6 00     ; 
     616/    EBF7 : 81 04                               CMPA    #$04                     ; EBF4: 81 04     ; End of line ?
     617/    EBF9 : 26 F7                               BNE     ZEBEF                    ; EBF6: 26 F7     ; 
     618/    EBFB : 86 1B                               LDAA    #$1B                     ; EBF8: 86 1B     ; 
     619/    EBFD : 8D D0                               BSR     LIST                     ; EBFA: 8D D0     ; 
     620/    EBFF : 39                                  RTS                              ; EBFC: 39        ; 
     621/    EC00 :                     ;------------------------------------------------
     622/    EC00 : 00                                  FCB     $00                      ; EBFD: 00             
     623/    EC01 : 00                                  FCB     $00                      ; EBFE: 00             
     624/    EC02 : 00                                  FCB     $00                      ; EBFF: 00             
     625/    EC03 :                     
     626/    EC03 :                     
     627/    EC03 :                                     END
 AS V1.42 Beta [Bld 216] - Source File floppy2_commented.asm - Page 12 - 01/08/2026 08:09:42 PM


  Symbol Table (* = unused):
  --------------------------

*ARCHITECTURE :                                      "x86_64-unknown-linux" - |
*BIGENDIAN :                      0 - | *BRANCHEXT :                      0 - |
*CASESENSITIVE :                  0 - |  CHKERR :                      E853 C |
 CLKDMD :                      EB88 C |  CLOCK :                       E887 C |
 CLRTOP :                      EB93 C | *COMPMODE :                       0 - |
*CONSTPI :        3.141592653589793 - |  CURADRH :                        6 - |
 CURDRV :                         0 - | *CUSTOM :                         0 - |
*DATE :                "01/08/2026" - |  DRVRDY :                      E8C5 C |
 DSKWPROT :                    EA98 C |  ERRHNDLR :                    E994 C |
*FALSE :                          0 - |  FDINIT :                      E822 C |
 FDINIT2 :                     E850 C |  FDINIT3 :                     EBA9 C |
 FDSTAT :                         8 - | *FULLPMMU :                       1 - |
 FUNCSAV :                        E - | *HAS64 :                          1 - |
*HASDSP :                         0 - | *HASFPU :                         0 - |
*HASPMMU :                        0 - | *INEXTMODE :                      0 - |
*INLWORDMODE :                    0 - | *INMAXMODE :                      0 - |
*INSRCMODE :                      0 - | *INSUPMODE :                      0 - |
 LDADDR :                        20 - | *LDATA0 :                      EBE7 C |
 LIST :                        EBCF C | *LISTON :                         1 - |
*LPINIT :                      EBC3 C |  LSCTLN :                         5 - |
 M0009 :                          9 - |  M0012 :                         12 - |
 M0014 :                         14 - |  M0018 :                         18 - |
 M0019 :                         19 - | *MACEXP :                         7 - |
 MEC26 :                       EC26 - |  MEC27 :                       EC27 - |
*MOMCPU :                      6800 - | *MOMCPUNAME :                "6800" - |
*NESTMAX :                      100 - |  NMIISR :                      E93C C |
 NMISVC :                      FFFC - |  NMIVECSAV :                      F - |
 NUMSCTH :                        3 - |  NUMSCTL :                        4 - |
*OSLOAD :                      E800 C | *PACKING :                        0 - |
*PADDING :                        0 - |  PIACTRL :                     EC02 - |
 PIAREGA :                     EC00 - |  PIAREGB :                     EC01 - |
 PRNTER :                      E85A C |  PROM_0 :                      FCFC - |
*PWRUP :                       F000 - | *RDCRC :                       E86F C |
 READCRC :                     EAC0 C |  READINIT :                    E9AF C |
*READPS :                      E86D C |  READSC :                      E869 C |
 READSECT :                    EAA0 C |  REENT2 :                      F564 - |
*RELAXED :                        0 - |  RESTOR :                      E875 C |
 RESTORN :                     E8D5 C |  RESTORY :                     E90D C |
 RETRG :                       EB77 C | *RWTEST :                      E872 C |
 SECTCNT :                        B - |  SECTOR :                         A - |
*SEEK :                        E878 C |  SETERR :                      E943 C |
 SSDA_0 :                      EC04 - |  SSDA_1 :                      EC05 - |
 STACKSAV :                      16 - |  STATSAV :                        D - |
 STEP :                        E949 C |  STRSCTH :                        1 - |
 STRSCTL :                        2 - | *TIME :               "08:09:42 PM" - |
 TRACKSAV :                      13 - | *TRUE :                           1 - |
*VERSION :                     142F - |  WAIT1 :                       E958 C |
 WAIT2 :                       E95F C |  WAIT3 :                       E956 C |
 WRDCNT :                        15 - | *WRDDAM :                      E87E C |
 WRITINIT :                    EAE0 C | *WRITSC :                      E884 C |
*WRTEST :                      E87B C | *WRVERF :                      E881 C |
 XOUTCH :                      F018 - |  XSTAKS :                      FF8A - |
*Z80SYNTAX :                      0 - |  ZE84F :                       E84F C |
 ZE866 :                       E866 C |  ZE8AD :                       E8B0 C |
 ZE8BB :                       E8BE C |  ZE8BE :                       E8C1 C |
 ZE8CB :                       E8CE C |  ZE8EA :                       E8ED C |
 ZE8FB :                       E8FE C |  ZE917 :                       E91A C |
 AS V1.42 Beta [Bld 216] - Source File floppy2_commented.asm - Page 13 - 01/08/2026 08:09:42 PM


 ZE91F :                       E922 C |  ZE93E :                       E941 C |
 ZE961 :                       E964 C |  ZE96A :                       E96D C |
 ZE980 :                       E983 C |  ZE984 :                       E987 C |
 ZE9A5 :                       E9A8 C |  ZE9CA :                       E9CD C |
 ZE9D3 :                       E9D6 C |  ZE9E5 :                       E9E8 C |
 ZE9F2 :                       E9F5 C |  ZE9FB :                       E9FE C |
 ZEA0C :                       EA0F C |  ZEA1A :                       EA1D C |
 ZEA1C :                       EA1F C |  ZEA26 :                       EA29 C |
 ZEA32 :                       EA35 C |  ZEA3E :                       EA41 C |
 ZEA46 :                       EA49 C |  ZEA52 :                       EA55 C |
 ZEA64 :                       EA67 C |  ZEA6B :                       EA6E C |
 ZEA70 :                       EA73 C |  ZEA86 :                       EA89 C |
 ZEA89 :                       EA8C C |  ZEA98 :                       EA9B C |
 ZEA9A :                       EA9D C |  ZEAA4 :                       EAA7 C |
 ZEABB :                       EABE C |  ZEACD :                       EAD0 C |
 ZEACF :                       EAD2 C |  ZEB07 :                       EB0A C |
 ZEB11 :                       EB14 C |  ZEB2A :                       EB2D C |
 ZEB2C :                       EB2F C |  ZEB31 :                       EB34 C |
 ZEB43 :                       EB46 C |  ZEB4D :                       EB50 C |
 ZEB53 :                       EB56 C |  ZEB5D :                       EB60 C |
 ZEB67 :                       EB6A C |  ZEB8A :                       EB8D C |
 ZEB91 :                       EB94 C |  ZEB9C :                       EB9F C |
 ZEBAC :                       EBAF C |  ZEBAD :                       EBB0 C |
 ZEBBB :                       EBBE C |  ZEBCF :                       EBD2 C |
 ZEBDA :                       EBDD C |  ZEBEF :                       EBF2 C |

    163 symbols
     43 unused symbols

 AS V1.42 Beta [Bld 216] - Source File floppy2_commented.asm - Page 14 - 01/08/2026 08:09:42 PM


  Code Pages:
  ----------

STANDARD (0 changed characters)

1 code page

0.01 seconds assembly time

    628 lines source file
      2 passes
      0 errors
      0 warnings
